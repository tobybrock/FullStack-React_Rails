(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{"./app/gamma/src/util/cross-flow-essentials.ts":function(e,n,t){"use strict";t.r(n),t.d(n,"getTenantlessProductStoreUrl",(function(){return l})),t.d(n,"getTenantlessCrossFlowUrl",(function(){return d})),t.d(n,"UtmCampaign",(function(){return u})),t.d(n,"setLocationToWacSoftware",(function(){return p})),t.d(n,"setLocationToTryProduct",(function(){return f})),t.d(n,"getSuggestedSiteNames",(function(){return v})),t.d(n,"getCrossFlowEssentialsV2Props",(function(){return b})),t.d(n,"SWITCHER_AVAILABLE_PRODUCTS_URL",(function(){return _})),t.d(n,"AVAILABLE_SITES_PROXY_URL",(function(){return g})),t.d(n,"getAvailableSites",(function(){return w}));var r=t("./packages/config/index.ts"),a=t("./packages/atlassian-analytics/index.ts"),i=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/index.js");function s(e,n,t,r,a,i,s){try{var o=e[i](s),c=o.value}catch(e){return void t(e)}o.done?n(c):Promise.resolve(c).then(r,a)}function o(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,n){if(!e)return;if("string"==typeof e)return c(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c(e,n)}(e))){var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,i=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var u,l=function(){var e=new URL(r.atlassianApiGateway);return e.pathname="gpa-product-store/tenantless.html",e.toString()},d=function(){var e=new URL(r.atlassianApiGateway);return e.pathname="gpa-cross-flow/",e.toString()};!function(e){e.ATLASSIAN_SWITCHER="atlassian_switcher",e.PRODUCT_STORE="product_store",e.CROSSFLOW_ESSENTIALS="cross_flow_essentials_v2",e.TOUCHPOINTS_JSW_BOARD="trello_jsw_touchpoints_board",e.TOUCHPOINTS_JSW_POWERUPS="trello_jsw_touchpoints_powerups",e.TOUCHPOINTS_JSW_SWITCHER="trello_jsw_touchpoints_switcher",e.TOUCHPOINTS_CONFLUENCE_SWITCHER="trello_confluence_touchpoints_switcher",e.TOUCHPOINTS_CONFLUENCE_POWERUPS="trello_confluence_touchpoints_powerups"}(u||(u={}));var m=function(e){var n=e.campaign;return"utm_source=trello&utm_medium=in_product_ad&utm_campaign=".concat(n)},p=function(e){var n=m(e);window.open("".concat(r.wacUrl,"/software?").concat(n),"_blank")},f=function(e,n){var t=m(n);if(e!==i.a.OPSGENIE){var a={[i.a.JIRA_SOFTWARE]:"jira-software",[i.a.JIRA_SERVICE_DESK]:"jira-service-desk",[i.a.CONFLUENCE]:"confluence"}[e];a?window.open("".concat(r.wacUrl,"/try/cloud/signup?bundle=").concat(a,"&edition=free&").concat(t),"_blank"):p(n)}else window.open("".concat(r.wacUrl,"/software/opsgenie/try?").concat(t),"_blank")},v=function(e,n,t){var r=[];function a(e){r.length<5&&r.push(e)}var i,s=o(e);try{var c=function(){var e=i.value;if(5===r.length)return"break";r.push(e.displayName);var t=n.filter((function(n){return n.idEnterprise===e.id}));t.forEach((function(n){a("".concat(e.displayName,"-").concat(n.displayName))})),t.forEach((function(e){a(e.displayName)}))};for(s.s();!(i=s.n()).done;){if("break"===c())break}}catch(e){s.e(e)}finally{s.f()}return n.forEach((function(e){e.idEnterprise||a(e.displayName)})),t&&t.name&&a(t.name),r},b=function(e){switch(e){case"variation-free":return{isCrossFlowV2Enabled:!0,edition:"free"};case"variation-standard":return{isCrossFlowV2Enabled:!0,edition:"standard"};default:return{isCrossFlowV2Enabled:!1}}},_="".concat(r.atlassianApiGateway,"gateway/api/available-products/api/available-products"),g="".concat(r.siteDomain,"/proxy/experiment-api/trello-cross-product-join/available-sites"),w=function(){var e,n=(e=regeneratorRuntime.mark((function e(n){var t,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=n?_:g,e.next=4,fetch(t,{method:"GET",credentials:"include",headers:{"X-Trello-Client-Version":r.clientVersion}});case 4:if(!(i=e.sent).ok){e.next=7;break}return e.abrupt("return",i.json());case 7:throw new Error("unauthorized");case 10:return e.prev=10,e.t0=e.catch(0),a.Analytics.sendOperationalEvent({action:"errored",actionSubject:"fetchAvailableSites",source:"crossFlowOverlay"}),e.abrupt("return",{sites:[]});case 14:case"end":return e.stop()}}),e,null,[[0,10]])})),function(){var n=this,t=arguments;return new Promise((function(r,a){var i=e.apply(n,t);function o(e){s(i,r,a,o,c,"next",e)}function c(e){s(i,r,a,o,c,"throw",e)}o(void 0)}))});return function(e){return n.apply(this,arguments)}}()},"./app/src/components/CrossFlowProvider/CrossFlowProvider.tsx":function(e,n,t){"use strict";t.r(n),t.d(n,"CrossFlowProvider",(function(){return _}));var r=t("./node_modules/react/index.js"),a=t.n(r),i=t("./app/gamma/src/util/cross-flow-essentials.ts"),s=t("./packages/config/index.ts"),o=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/trello.js"),c=t("./packages/atlassian-analytics/index.ts"),u="GetSuggestedSiteNames",l="GetAvailableSites",d=t("./node_modules/@apollo/react-hooks/lib/react-hooks.esm.js"),m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CrossFlowProvider"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"memberId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"member"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"memberId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"},arguments:[]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"idPremOrgsAdmin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isAaMastered"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"prefs"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locale"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"enterprises"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"organizations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"idEnterprise"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}]};function p(e,n,t,r,a,i,s){try{var o=e[i](s),c=o.value}catch(e){return void t(e)}o.done?n(c):Promise.resolve(c).then(r,a)}function f(e){return function(){var n=this,t=arguments;return new Promise((function(r,a){var i=e.apply(n,t);function s(e){p(i,r,a,s,o,"next",e)}function o(e){p(i,r,a,s,o,"throw",e)}s(void 0)}))}}var v="prod"===s.environment?"production":"staging",b=s.atlassianApiGateway.endsWith("/")?s.atlassianApiGateway.substr(0,s.atlassianApiGateway.length-1):s.atlassianApiGateway,_=function(e){var n,t,r,s,p=e.children,_=(s={variables:{memberId:"me"}},d.c(m,s)).data,g=_&&(null==_?void 0:_.member),w=null!==(n=null==g?void 0:g.enterprises)&&void 0!==n?n:[],k=null!==(t=null==g?void 0:g.organizations)&&void 0!==t?t:[],S=Boolean(null==g?void 0:g.isAaMastered),E={id:(null==g?void 0:g.id)||"",idPremOrgsAdmin:(null==g?void 0:g.idPremOrgsAdmin)||[],isAaMastered:S,name:(null==g?void 0:g.fullName)||"",enterprises:w},h=(null==g||null===(r=g.prefs)||void 0===r?void 0:r.locale)||"en",O=function(e){return[u,e]}(f(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i.getSuggestedSiteNames)(w,k,E));case 1:case"end":return e.stop()}}),e)})))),y=function(e){return[l,e]}(f(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(i.getAvailableSites)(S));case 1:case"end":return e.stop()}}),e)}))));return a.a.createElement(o.a,{analyticsClient:c.Analytics.dangerouslyGetAnalyticsWebClient(),locale:h,edgePrefix:b,isAaMastered:S,env:v,plugins:[O,y]},p)}},"./node_modules/@atlaskit/analytics-gas-types/dist/esm/index.js":function(e,n,t){"use strict";t.d(n,"e",(function(){return r})),t.d(n,"d",(function(){return a})),t.d(n,"c",(function(){return i})),t.d(n,"b",(function(){return s})),t.d(n,"a",(function(){return o}));var r="ui",a="track",i="screen",s="operational",o="unknown"},"./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js":function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"d",(function(){return m})),t.d(n,"b",(function(){return s})),t.d(n,"c",(function(){return o}));t("./node_modules/tslib/tslib.es6.js");var r=t("./node_modules/react/index.js"),a=t.n(r),i=function(e){return{open:function(n){return e(n)}}},s={GET_STARTED:"get-started",DECIDE:"decide",DISCOVER:"discover"},o={CONFLUENCE:"confluence.ondemand",JIRA_CORE:"jira-core.ondemand",JIRA_SERVICE_DESK:"jira-servicedesk.ondemand",JIRA_SOFTWARE:"jira-software.ondemand",BITBUCKET:"bitbucket.ondemand",TRELLO:"trello",OPSGENIE:"opsgenie",STATUSPAGE:"statuspage"},c="Could not provide requested API version",u="Provider not found",l=Object(r.createContext)((function(){return{isEnabled:!1,reason:u}})),d=function(e){var n=e.onOpen,t=e.children,s=Object(r.useMemo)((function(){return function(e){return function(n){switch(n){case 0:return{isEnabled:!0,api:i(e)};default:return{isEnabled:!1,reason:c}}}}(n)}),[n]);return a.a.createElement(l.Provider,{value:s},t)},m=function(){return Object(r.useContext)(l)(0)}},"./node_modules/@atlassiansox/cross-flow-support/dist/esm/index.js":function(e,n,t){"use strict";var r=t("./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js");t.d(n,"b",(function(){return r.d})),t.d(n,"a",(function(){return r.c}))},"./node_modules/@atlassiansox/cross-flow-support/dist/esm/lib/redirects-helpers/redirectsHelpers.js":function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r,a=t("./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js");!function(e){e["atlassian-switcher"]="atlassian_switcher"}(r||(r={}));var i={"atlassian-switcher":r["atlassian-switcher"]},s=function(e,n){var t="";return e&&function(e){return Boolean(i[e])}(e)&&(t=t+"utm_campaign="+i[e]+"&utm_medium=in_product_ad",n&&(t=t+"&utm_source="+n)),t},o=function(e,n,t,r){var i="staging"===n?"https://qa-wac.internal.atlassian.com":"https://www.atlassian.com",o=s(t,r),c="",u="",l="/software";return!function(e){return[a.c.JIRA_SOFTWARE,a.c.JIRA_SERVICE_DESK,a.c.JIRA_CORE,a.c.CONFLUENCE].includes(e)}(e)?function(e){return[a.c.OPSGENIE].includes(e)}(e)&&(l=function(e){var n;return((n={})[a.c.OPSGENIE]="/software/opsgenie/try",n)[e]}(e)):(l="/try/cloud/signup",u=function(e){var n;return"bundle="+((n={})[a.c.JIRA_SOFTWARE]="jira-software",n[a.c.JIRA_SERVICE_DESK]="jira-service-desk",n[a.c.JIRA_CORE]="jira-core",n[a.c.CONFLUENCE]="confluence",n)[e]+"&edition=free"}(e)),u&&(c=c+"?"+u),o&&(c=c+(c?"&":"?")+o),i+l+c},c=function(e,n,t,r){void 0===n&&(n="production");var a=o(e,n,t,r);window.open(a,"_blank")}},"./node_modules/@atlassiansox/cross-flow-support/dist/esm/trello.js":function(e,n,t){"use strict";t.d(n,"b",(function(){return k.b}));var r,a=t("./node_modules/tslib/tslib.es6.js"),i=t("./node_modules/react/index.js"),s=t.n(i),o=t("./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js"),c=t("./node_modules/@atlaskit/analytics-gas-types/dist/esm/index.js"),u=function(e){return function(e,n){return n.reduce((function(n,t){return e.forEach((function(e){var r=t?t[e]:null;n.push(r||t[e])})),n}),[]).filter(Boolean)}(["source"],e)},l=function(e){return e[e.length-1]},d=function(e){var n=e.context,t=e.payload;if(!t)return null;var r=u(n),i=l(r)||c.a,s=function(e){return e.reduce((function(e,n){var t=n.attributes,r=Object(a.__rest)(n,["attributes"]),i=Object(a.__assign)(Object(a.__assign)({},e),r);return t?Object(a.__assign)(Object(a.__assign)({},i),t):i}),{})}(n),o=l(function(e){return e.map((function(e){return{packageName:e.packageName,packageVersion:e.packageVersion}})).filter((function(e){return e.packageName}))}(n))||{},d=o.packageName,m=void 0===d?void 0:d,p=o.packageVersion,f=void 0===p?void 0:p,v=t.eventType,b=void 0===v?c.e:v,_=t.action,g=t.actionSubject,w=t.actionSubjectId,k=t.attributes,S=t.name,E=Object(a.__assign)(Object(a.__assign)({packageName:m,packageVersion:f},s),k),h=t.tags||[];switch(h.push("growth"),b){case c.e:case c.b:case c.d:return{eventType:b,source:i,actionSubject:g,action:_,actionSubjectId:w,attributes:E,tags:h.slice(0)};case c.c:return{eventType:b,name:S,attributes:E,source:i,tags:h.slice(0)}}return null},m=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/lib/redirects-helpers/redirectsHelpers.js"),p=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/version.json"),f={eventType:c.b,action:"errorCaught",actionSubject:"errorBoundary"},v=[{source:"crossFlowProvider"},{packageName:p.name,packageVersion:p.version}],b=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.state={hasError:!1},n}return Object(a.__extends)(n,e),n.getDerivedStateFromError=function(){return{hasError:!0}},n.prototype.componentDidCatch=function(){this.props.onAnalyticsEvent({payload:f,context:v})},n.prototype.render=function(){return this.state.hasError?null:this.props.children},n}(i.Component),_={version:p.version},g=s.a.lazy((function(){return t.e(19).then(t.bind(null,"./node_modules/@atlassiansox/cross-flow-support/dist/esm/lib/view/index.js"))})),w=(r=g,function(e){var n=e.children,t=e.analyticsClient,u=e.originProduct,l=e.redirectToWac,p=e.env,f=e.plugins,v=void 0===f?[]:f,g=Object(a.__rest)(e,["children","analyticsClient","originProduct","redirectToWac","env","plugins"]),w=Object(i.useRef)(),k=Object(a.__read)(Object(i.useState)(!1),2),S=k[0],E=k[1],h=Object(i.useMemo)((function(){return function(e){return function(n){return Promise.resolve(e).then((function(e){switch(n.eventType){case c.e:e.sendUIEvent(n);break;case c.d:e.sendTrackEvent(n);break;case c.b:e.sendOperationalEvent(n);break;case c.c:e.sendScreenEvent(n)}}))}}(t)}),[t]),O=Object(a.__read)(Object(i.useState)(),2),y=O[0],j=O[1],C=Object(i.useCallback)((function(e){var n,t,r=d(e);if(r){var i=function(e,n){if(!n)return e;var t=Object(a.__assign)(Object(a.__assign)({},e.attributes||{}),{sourceComponent:n.sourceComponent,sourceContext:n.sourceContext});return Object(a.__assign)(Object(a.__assign)({},e),{attributes:t})}((n=r,t=Object(a.__assign)(Object(a.__assign)({},n.attributes||{}),{crossFlowSupport:_}),Object(a.__assign)(Object(a.__assign)({},n),{attributes:t})),y);h(i)}}),[h,y]),N=Object(i.useCallback)((function(e){S||(C({payload:{eventType:c.b,action:"uiInitialized",actionSubject:"crossFlowSupport",appName:e},context:[{source:"crossFlowProvider"}]}),E(!0))}),[S,C]),A=Object(i.useCallback)((function(e){return E(!1),C({payload:{eventType:c.b,action:"openInvoked",actionSubject:"crossFlowSupport",attributes:{sourceComponent:e.sourceComponent,sourceContext:e.sourceContext}},context:[{source:"crossFlowProvider"}]}),e.journey===o.b.GET_STARTED&&l?(Object(m.a)(e.targetProduct,p,e.sourceComponent,e.sourceContext),Promise.resolve({})):(j(e),new Promise((function(e){w.current=e})))}),[C,p,l]),T=Object(i.useCallback)((function(e){E(!1),j(void 0),w.current&&w.current(e)}),[]);return s.a.createElement(o.a,{onOpen:A},n,y&&s.a.createElement(b,{onAnalyticsEvent:C},s.a.createElement(i.Suspense,{fallback:null},s.a.createElement(r,Object(a.__assign)({},g,y,{onAnalyticsEvent:C,originProduct:u,onClose:T,onHandShake:N,plugins:v,env:p,redirectToWac:l})))))}),k=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/index.js");n.a=function(e){var n=!e.isAaMastered;return s.a.createElement(w,Object(a.__assign)({},e,{isTenantless:!0,originProduct:"trello",redirectToWac:n}))}},"./node_modules/@atlassiansox/cross-flow-support/dist/esm/version.json":function(e,n){e.exports={name:"@atlassiansox/cross-flow-support",version:"0.23.10"}}},0,[19]]);
//# sourceMappingURL=cross-flow-provider.4420a513f543898b5fb4.js.map